# rails-server-aws
Terraform script that provides all required infrastructure and deploys the Docker image with Rails application to the AWS Elastic Container Registry.

## Prequisites
#### Setting up AWS authentication for Terraform Resource Provisioning
- To use terraform with AWS, Please set up authentication with AWS. You can use this documentation - https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication-and-configuration.
- Once you have followed the above mentioned documentation, you should have a IAM User and Access Key/Secrets.
- Set the below enviroment variable in your terminal.
    ```
    export AWS_ACCESS_KEY_ID="anaccesskey"
    export AWS_SECRET_ACCESS_KEY="asecretkey"
    export AWS_REGION="us-west-2"
    ```

## How to deploy the infrastruture?

#### Input Parameters
- These variables are used in the Terraform configuration file to create the ECR container registry, Redis cluster, S3 bucket, ECS service, CloudWatch log group, and Opensearch domain. 
    1. ECR Related Variables
        - `container-registry-name`: The name of the ECR container registry.
    2. Redis specific variables/parameters
        - `redis-cluster-name`: The name of the Redis cluster.
        - `redis-cluster-node-type`: The type of Redis node.
        - `redis-cluster-node-num`: The number of Redis nodes in the cluster.
        - `redis-cluster-parameter-group-name`: The name of the Redis parameter group.
        - `redis-cluster-version`: The version of Redis to use.
        - `redis-cluster-port`: The port that Redis will listen on.
    3. S3
        - `s3-bucket-name`: The name of the S3 bucket that will store the server's data.
    4. ECS Cluster
        - `container-service-name`: The name of the ECS service that will run the server.
    5. Cloud Watch Service Logs
        - `cloud-watch-log-name`: The name of the CloudWatch log group that will store the server's logs.
    6. Opensearch Instance Variables
        - `opensearch-domain-name`: The name of the Opensearch domain.
        - `opensearch-domain-engine-version`: The version of Opensearch to use.
        - `opensearch-domain-instance-type`: The type of Opensearch instance.
    7. Application Name
        - `application-name`: The name of the application.

#### Outputs
- These outputs are generated by the Terraform configuration file and can be used to access the resources that have been created.
    - `container-registry-name` : The name of the ECR container registry.
    - `container-registry-id` : The ID of the ECR container registry.
    - `container-registry-repository-url` : The URL of the ECR container repository.
    - `cloud-watch-name` : The name of the CloudWatch log group.
    - `container-service-cluster-name` : The name of the ECS cluster.
    - `redis-cluster-address` : The address of the Redis cluster.
    - `opensearch-domain-endpoint` : The endpoint of the Opensearch domain.
    - `s3-bucket-name` : The name of the S3 bucket.
    - `app_url` : The URL of the application.

#### Usage
- Use the below commands to provision the infrastructure and deploy the docker image.
    - `terraform init` to initialize the hashicorp terraform provider and AWS provider.
    - `terraform validate` to validate our changes.
    - `terraform plan` to see the plan of terraform, resources it is going to deploy.
    - And `terraform apply` to apply the changes to AWS.
- Once you perform the above commands in sequence, our app should be running



